/* 
 * yhge v0.12
 */
var yhge={core:{},renderer:{canvas:{shape:{},swf:{}},webgl:{}},times:{},math:{},event:{ui:{}},input:{},audo:{},scene:{},ui:{canvas:{}},network:{},isometric:{},tiled:{},animation:{},fx:{}};
(function(){var g=Object.prototype,a=window;yhge.core={ucfirst:function(c){c+="";return c.charAt(0).toUpperCase()+c.substr(1)},lcfirst:function(c){c+="";return c.charAt(0).toLowerCase()+c.substr(1)},createNameSpace:function(c){var b=c.split(".");c=b.pop();var d=a,e;for(var f in b){e=yhge.ucfirst(b[f]);d=e in d?d[e]:(d[e]={})}return{ns:d,cName:c}},extend:function(c,b,d){if(typeof b=="object"){d=b;b=c;c=d.constructor!==g.constructor?d.constructor:function(){b.apply(this,arguments)}}if(b){this.mixinIf(true,
c,b);if(c._super_){this.mixinIf(true,c._super_,b.prototype);this.mixinIf(true,c.prototype,b.prototype)}else{var e=function(){},f=b.prototype;e.prototype=f;e=c.prototype=new e;e.constructor=c;c._super_=f;c._superclass_=b;if(f.constructor===g.constructor)f.constructor=b;d&&this.mixin(true,e,d)}return c}},inherits:function(){return this.extend.apply(this,arguments)},declare:function(c,b){var d;switch(typeof c){case "string":c=yhge.createNameSpace(c);var e=yhge.ucfirst(c.cName);d=c.ns[e]=b?function(){d._superclass_.apply(this,
arguments)}:function(){this.initialize.apply(this,arguments)};d.namespace=c.ns;d.classname=e;break;case "undefined":d=b?function(){d._superclass_.apply(this,arguments)}:function(){this.initialize.apply(this,arguments)};break;default:d=c}return d},Class:function(c,b,d,e){var f;f=c;if(f!=null){switch(typeof f){case "function":f=undefined;c=c;b=b;d=d;break;case "object":if(f instanceof Array){f=undefined;c=c;b=b;d=d}else{f=c.base;b=c.overrides;d=c.content;c=c.extend}break;case "string":default:if(typeof b==
"function"||b instanceof Array){c=b;b=d;d=e}else{c=null;b=b;d=d}break}f=this.declare(f,c);if(c){c=c instanceof Array?c:[c];superclass=c[0];e=function(){};var h=superclass.prototype;e.prototype=h;h=new e;h=[h];for(var i=1,k=c.length;i<k;i++)c[i].prototype&&h.push(c[i].prototype);h=this.mixinIf.apply(this,h);e.prototype=h;e=f.prototype=new e;e.constructor=f;f._super_=h;f._superclass_=superclass;if(h.constructor===g.constructor)h.constructor=superclass;b&&this.mixin(true,e,b);this.mixinIf.apply(this,
(d?[true,f,d]:[true,f]).concat(c))}else{b&&this.mixin(true,f.prototype,b);d&&this.mixin(true,f,d)}return f}},mixin:function(){var c=false,b;if(arguments.length==0)return{};var d=arguments[0],e=1;if(typeof d==="boolean"){c=d;d=arguments[1]||{};e=2}if(typeof d!="object"&&typeof d!="function")d={};for(;e<arguments.length;e++)if((b=arguments[e])!=null)for(name in b)if(!(name=="_super_"||name=="_superclass_")){copy=b[name];if(!(copy==null||d===copy))if(c&&typeof copy=="object"){(src=d[name])||(src=copy instanceof
Array?[]:{});d[name]=this.mixin(c,src,copy)}else if(copy!==undefined)d[name]=copy}return d},mixinIf:function(){var c=false,b;if(arguments.length==0)return{};var d=arguments[0],e=1;if(typeof d==="boolean"){c=d;d=arguments[1]||{};e=2}if(typeof d!="object"&&typeof d!="function")d={};for(;e<arguments.length;e++){if((b=arguments[e])!=null)for(name in b)if(!(name=="_super_"||name=="_superclass_")){copy=b[name];if(!(copy==null||d===copy)){src=d[name];if(c&&typeof copy=="object"){src||(src=copy instanceof
Array?[]:{});d[name]=this.mixin(c,src,copy)}else if(!src&&copy!==undefined)d[name]=copy}}b=arguments[e];if(typeof b!="object")return d;for(var f in b)if(!d[f]){var h=b[f];if(typeof h!="undefined")d[f]=h==null?null:typeof h=="object"?this.mixinIf(d[f],h):h}}return d},isPlainObject:function(c){if(!c||typeof c!=="object")return false;if(c.constructor&&!Object.prototype.hasOwnProperty.call(c,"constructor")&&!Object.prototype.hasOwnProperty.call(c.constructor.prototype,"isPrototypeOf"))return false;var b;
for(b in c);return b===undefined||Object.prototype.hasOwnProperty.call(c,b)}}})();
(function(){function g(e,f){return f.toUpperCase()}function a(e){return e.replace(d,g)}function c(e){e+="";return e.charAt(0).toUpperCase()+e.substr(1)}var b=yhge.core.Accessor=function(){this.initialize.apply(this,arguments)};b.prototype={getAttribute:function(e){e=a(e);if(this[e])return this[e];e="get"+c(e);return this[e]&&this[e]()},setAttribute:function(e,f){e=a(e);var h="set"+c(e);if(this[h])this[h](f);else this[e]=f;return this},setAttributes:function(e){for(var f in e)this.setAttribute(f,e[f]);
return this},registerAccessors:function(e,f,h){var i=this;e=c(e);if(f)i["get"+e]=f;if(h)i["set"+e]=h;return this},synthesizeProperty:function(e,f){e=a(e);var h="_"+e;this.registerAccessors(e,function(){return this[h]},f?function(i){this[h]=i;f.apply(this,arguments);return this}:function(i){this[h]=i;return this});return this},synthesizePropertys:function(e){for(var f=0,h=e.length;f<h;f++)this.synthesizeProperty(e[f]);return this}};b.registerAccessors=function(e,f,h){var i=this.prototype;e=c(e);if(f)i["get"+
e]=f;if(h)i["set"+e]=h;return this};b.synthesizeProperty=function(e,f){e=a(e);var h="_"+e;this.registerAccessors(e,function(){return this[h]},f?function(i){this[h]=i;f.apply(this,arguments);return this}:function(i){this[h]=i;return this});return this};b.synthesizePropertys=function(e){for(var f=0,h=e.length;f<h;f++)this.synthesizeProperty(e[f]);return this};yhge.core.accessor={getAttribute:function(e){e=a(e);if(this[e])return this[e];e="get"+c(e);return this[e]&&this[e]()},setAttribute:function(e,
f){e=a(e);var h="set"+c(e);if(this[h])this[h](f);else this[e]=f;return this},setAttributes:function(e){for(var f in e)this.setAttribute(f,e[f]);return this},registerAccessors:function(e,f,h){var i=typeof this=="function"?this.prototype:this;e=c(e);if(f)i["get"+e]=f;if(h)i["set"+e]=h;return this},synthesizeProperty:function(e,f){e=a(e);var h="_"+e;this.registerAccessors(e,function(){return this[h]},f?function(i){this[h]=i;f.apply(this,arguments);return this}:function(i){this[h]=i;return this});return this},
synthesizePropertys:function(e){for(var f=0,h=e.length;f<h;f++)this.synthesizeProperty(e[f]);return this},mixinTo:function(e){if(typeof e==="function"){var f=e.prototype;f.getAttribute=this.getAttribute;f.setAttribute=this.setAttribute;f.setAttributes=this.setAttributes;e.registerAccessors=this.registerAccessors;e.synthesizeProperty=this.synthesizeProperty;e.synthesizePropertys=this.synthesizePropertys}}};var d=/_([a-z])/ig})();
(function(){var g={};yhge.core.require=yhge.require=function(a){if(g[a])return g[a]};yhge.core.load=yhge.load=function(a,c,b){var d=document.getElementsByTagName("head")[0]||document.documentElement,e=document.createElement("script");e.async="async";if(b)e.charset=s.scriptCharset;e.src=a;var f=false;e.onload=e.onreadystatechange=function(){if(!f&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){f=true;e.onload=e.onreadystatechange=null;d&&e.parentNode&&d.removeChild(e);
e=undefined;c&&c()}};d.insertBefore(e,d.firstChild)}})();(function(){Math.PI_2=1.5707963267948966;var g={Point:function(a,c){this.x=a;this.y=c},Size:function(a,c){this.width=a;this.height=c},Rect:function(a,c,b,d){this.origin=new g.Point(a,c);this.size=new g.Size(b,d)},degreesToRadians:function(a){return a/180*Math.PI},radiansToDegrees:function(a){return a*(180/Math.PI)}};yhge.math.Geometry=yhge.geo=g})();
(function(){var g=yhge.math.QuatNode=function(){this.initialize.apply(this,arguments)};g.prototype={_id:0,_type:0,_range:null,_center:null,_parent:null,_depth:0,_children:null,_branches:null,initialize:function(a,c){this._range=a;this._center={x:(this._range.left+this._range.right)/2,y:(this._range.top+this._range.bottom)/2};this._parent=c;this._children=[];this._branches=[];this._depth=c?c._depth+1:0},setRange:function(a){this._range=a;this._center={x:(this._range.right+this._range.left)/2,y:(this._range.top+
this._range.bottom)/2}},split:function(){var a=this._range.left,c=this._range.right,b=this._center.x,d=this._range.top,e=this._range.bottom,f=this._center.y;this._branches.push(new g({left:a,top:d,right:b,bottom:f},this));this._branches.push(new g({left:b,top:d,right:c,bottom:f},this));this._branches.push(new g({left:a,top:f,right:b,bottom:e},this));this._branches.push(new g({left:b,top:f,right:c,bottom:e},this));this._type=1},splitUntilDepth:function(a){if(this._depth<a){this.split();for(var c=0,
b=this._branches.length;c<b;c++)this._branches[c].splitUntilDepth(a)}},splitUntilGridSize:function(a){var c=this._range.bottom-this._range.top;if(this._range.right-this._range.left>a.width||c>a.height){this.split();c=0;for(var b=this._branches.length;c<b;c++)this._branches[c].splitUntilGridSize(a)}},search:function(a){if(a.left>=this._range.left&&a.right<=this._range.right&&a.top>=this._range.top&&a.bottom<=this._range.bottom){for(var c,b=0,d=this._branches.length;b<d;b++)if(c=this._branches[b].search(a))return c;
return this}else return false},searchPoint:function(a,c){if(a>=this._range.left&&a<=this._range.right&&c>=this._range.top&&c<=this._range.bottom){c=0;for(var b=this._branches.length;c<b;c++)if(a=this._branches[c].searchPoint(range))return a;return this}else return false},searchChildrenInRange:function(a){var c=this.getChildrenInRange(a);if(this._type){var b=this._center,d=b.x;b=b.y;var e;if(a.left<d&&a.top<b)c=(e=this._branches[0].searchChildrenInRange({left:a.left,top:a.top,right:d,bottom:b}))?c.concat(e):
c;if(a.right>d&&a.top<b)c=(e=this._branches[1].searchChildrenInRange({left:d,top:a.top,right:a.right,bottom:b}))?c.concat(e):c;if(a.left<d&&a.bottom>b)c=(e=this._branches[2].searchChildrenInRange({left:a.left,top:b,right:d,bottom:a.bottom}))?c.concat(e):c;if(a.right>d&&a.bottom>b)c=(e=this._branches[3].searchChildrenInRange({left:d,top:b,right:a.right,bottom:a.bottom}))?c.concat(e):c}return c},searchChildrenContainPoint:function(a,c){var b=this.getChildrenContainPoint(a,c);if(this._type){var d=this._center,
e=d.x,f=d.y;d=[];switch((a<e?1:a>e?4:2)+(c<f?8:c>f?32:16)){case 9:d.push(this._branches[0]);break;case 12:d.push(this._branches[1]);break;case 33:d.push(this._branches[2]);break;case 36:d.push(this._branches[3]);break;case 10:d.push(this._branches[0]);d.push(this._branches[1]);break;case 34:d.push(this._branches[2]);d.push(this._branches[3]);break;case 17:d.push(this._branches[0]);d.push(this._branches[2]);break;case 20:d.push(this._branches[1]);d.push(this._branches[3]);break;case 18:default:d=this._branches;
break}f=0;for(var h=d.length;f<h;f++)b=(e=d[f].searchChildrenContainPoint(a,c))?b.concat(e):b}return b},getChildrenInRange:function(a){for(var c=[],b=0,d,e=this._children.length;b<e;b++){d=this._children[b];d.left>=a.left&&d.right<=a.right&&d.top>=a.top&&d.bottom<=a.bottom&&c.push(d.obj)}return c},getChildrenContainPoint:function(a,c){for(var b=[],d=0,e,f=this._children.length;d<f;d++){e=this._children[d];a>=e.left&&a<=e.right&&c>=e.top&&c<=e.bottom&&b.push(e.obj)}return b},add:function(a){this._children.push(a)},
remove:function(a){a=this._children.indexOf(a);a>-1&&this._children.splice(a,1)}};(yhge.math.QuatTree=function(){this.initialize.apply(this,arguments)}).prototype={_root:null,initialize:function(a){console.log("init quatree");this._bounding=a={left:a.x,top:a.y,right:a.x+a.width,bottom:a.y+a.height};this._root=new g(a,null)},build:function(a){typeof a=="object"?this.splitUntilSize(this._root,a):this.splitUntilDepth(this._root,a)},splitUntilDepth:function(a,c){if(a._depth<c){a.split();for(var b=0,d=
a._branches.length;b<d;b++)this.splitUntilDepth(a._branches[b],c)}},splitUntilSize:function(a,c){var b=a._range.bottom-a._range.top;if(a._range.right-a._range.left>c.width||b>c.height){a.split();b=0;for(var d=a._branches.length;b<d;b++)this.splitUntilSize(a._branches[b],c)}},cutBounding:function(a){if(a.left<this._bounding.right&&a.right>this._bounding.left&&a.top<this._bounding.bottom&&a.bottom>this._bounding.top){a.left=a.left<this._bounding.left?this._bounding.left:a.left;a.right=a.right>this._bounding.right?
this._bounding.right:a.right;a.top=a.top<this._bounding.top?this._bounding.top:a.top;a.bottom=a.bottom>this._bounding.bottom?this._bounding.bottom:a.bottom;return a}else return false},add:function(a){var c={left:a._position.x,top:a._position.y,right:a._position.x+a._width,bottom:a._position.y+a._height};if(c=this.cutBounding(c)){c.obj=a;var b=this.search(c);if(b){b.add(c);c.parentNode=b;a.__range=c}}},remove:function(a){if(a.__range){a.__range.parentNode.remove(a.__range);delete a.__range.obj;delete a.__range}},
search:function(a){return this._root.search(a)},searchPoint:function(a,c){return this._root.searchPoint(a,c)},getObjsInRange:function(a){return this._root.searchChildrenInRange(a)},getObjsContainPoint:function(a,c){return this._root.searchChildrenContainPoint(a,c)}}})();
(function(){var g=function(){this.initialize.apply(this,arguments)};g.prototype={initialize:function(a,c,b,d,e,f){this.a=a;this.b=c;this.c=b;this.d=d;this.tx=e;this.ty=f},setTranslate:function(a,c){var b=this.ty+this.b*a+this.d*c;this.tx=this.tx+this.a*a+this.c*c;this.ty=b;return this},setRotate:function(a){var c=Math.sin(a);a=Math.cos(a);var b=this.a,d=this.b,e=this.c,f=this.d;this.a=b*a+e*c;this.b=d*a+f*c;this.c=e*a-b*c;this.d=f*a-d*c;return this},setScale:function(a,c){if(c===undefined)c=a;this.a*=
a;this.b*=a;this.c*=c;this.d*=c;return this},pointApply:function(a,c){return{x:this.a*a+this.c*c+this.tx,y:this.b*a+this.d*c+this.ty}},rectApply:function(a,c,b,d){var e=a;a=a+b;b=c;var f=c+d;c=this.pointApply(e,b);d=this.pointApply(a,b);var h=this.pointApply(e,f);f=this.pointApply(a,f);e=Math.min(c.x,d.x,h.x,f.x);a=Math.max(c.x,d.x,h.x,f.x);b=Math.min(c.y,d.y,h.y,f.y);f=Math.max(c.y,d.y,h.y,f.y);return{x:e,y:b,width:a-e,height:f-b}},boundingApply:function(a,c,b,d){var e=this.pointApply(a,b),f=this.pointApply(c,
b),h=this.pointApply(a,d);d=this.pointApply(c,d);a=Math.min(e.x,f.x,h.x,d.x);c=Math.max(e.x,f.x,h.x,d.x);b=Math.min(e.y,f.y,h.y,d.y);d=Math.max(e.y,f.y,h.y,d.y);return{left:a,right:c,top:b,bottom:d}},clone:function(){return new g(this.a,this.b,this.c,this.d,this.tx,this.ty)},invert:function(){var a=1/(this.a*this.d-this.b*this.c);return new g(a*this.d,-a*this.b,-a*this.c,a*this.a,a*(this.c*this.ty-this.d*this.tx),a*(this.b*this.tx-this.a*this.ty))},concat:function(a){return new g(this.a*a.a+this.b*
a.c,this.a*a.b+this.b*a.d,this.c*a.a+this.d*a.c,this.c*a.b+this.d*a.d,this.tx*a.a+this.ty*a.c+a.tx,this.tx*a.b+this.ty*a.d+a.ty)}};g.getIdentity=function(){return new g(1,0,0,1,0,0)};yhge.math.TransformMatrix=g})();
(function(){var g=yhge.core,a=yhge.math.QuatTree,c=g.Class(yhge.math.QuatNode,{split:function(){var b=this._range.left,d=this._range.right,e=this._center.x,f=this._range.top,h=this._range.bottom,i=this._center.y;this._branches.push(new c({left:b,top:f,right:e,bottom:i},this));this._branches.push(new c({left:e,top:f,right:d,bottom:i},this));this._branches.push(new c({left:b,top:i,right:e,bottom:h},this));this._branches.push(new c({left:e,top:i,right:d,bottom:h},this));this._type=1},getChildrenInRange:function(b){for(var d=
[],e=0,f,h,i=this._children.length;e<i;e++){f=this._children[e].obj;h=f.worldToNodeTransform().boundingApply(b);h.left<=0&&h.right>=f._width&&h.top<=0&&h.bottom>=f._height&&d.push(f)}return d},getChildrenContainPoint:function(b,d){for(var e=[],f=0,h,i,k=this._children.length;f<k;f++){h=this._children[f].obj;i=h.screenToLocal(b,d);i.x>=0&&i.x<=h._width&&i.y>=0&&i.y<=h._height&&e.push(h)}return e}});g=g.Class(a,{initialize:function(b){console.log("init TransformQuatTree");this._bounding=b={left:b.x,
top:b.y,right:b.x+b.width,bottom:b.y+b.height};this._root=new c(b,null)},add:function(b){var d;if(b.worldBoundingRect){d=b.worldBoundingRect();d={left:d.x,top:d.y,right:d.x+d.width,bottom:d.y+d.height}}else d={left:b._position.x,top:b._position.y,right:b._position.x+b._width,bottom:b._position.y+b._height};if(d=this.cutBounding(d)){d.obj=b;var e=this.search(d);if(e){e.add(d);d.parentNode=e;b.__range=d}}}});yhge.math.TransformQuatNode=c;yhge.math.TransformQuatTree=g})();
(function(){window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)};var g=yhge.times.Scheduler=function(){this.initialize.apply(this,arguments)};g.prototype={_interval:20,initialize:function(a){this._interval=a&&a.interval!=null?a.interval:this._interval;this._forceInterval=a&&a.forceInterval&&this._interval;this._tasks=[]},
run:function(){var a=this;this._lastTime=(new Date).getTime();if(window.requestAnimationFrame&&!this._forceInterval){this._runType=2;a.timerId=true;raf=function(){if(a.timerId){window.requestAnimationFrame(raf);a.tick()}};window.requestAnimationFrame(raf)}else{this._runType=1;a.timerId=setInterval(function(){a.tick()},this._interval)}},stop:function(){switch(this._runType){case 1:clearInterval(this.timerId);break;case 2:this.timerId=null;break}},tick:function(){for(var a=(new Date).getTime(),c=a-
this._lastTime,b=0,d=this._tasks.length,e;b<d;b++){e=this._tasks[b];e.action.call(e.content,c)}this._lastTime=a},addTask:function(a,c,b){if(typeof c!="number")if(b==null){b=c;c=0}else{var d=b;b=c;c=d}d=0;for(var e=this._tasks.length;d<e;d++)if(c<this._tasks[d].priority)break;this._tasks.splice(d,0,{action:a,priority:c,content:b})},removeTask:function(a){for(var c=0,b=this._tasks.length;c<b;c++)if(a<this._tasks[c].action)break;this._tasks.splice(c,1)},clearTask:function(){this._tasks=[]},setInterval:function(a){this._interval=
a;return this},getInterval:function(){return this._interval}};g.Render=50;g.Update=40;g.Animation=30;g.Timer=20;g.getInstance=function(a){if(!this._instance)this._instance=new g(a);return this._instance}})();
(function(){var g=yhge.times.Timer=function(){this.initialize.apply(this,arguments)};g.prototype={initialize:function(a){this._tasks=[];this.taskIdIndex=1;a&&a.addTask(this._run,yhge.times.Scheduler.Timer,this)},_run:function(a){for(var c=0,b;c<this._tasks.length;c++){(b=this._tasks[c])||console.log("i=",c,this._tasks);b.leftTime-=a;if(b.leftTime<=0){b.action.call(b.content,a);if(b.times&&--b.times==0)this._tasks.splice(c--,1);else b.leftTime+=b.delay}}},add:function(a,c,b,d){var e=Array.prototype.slice.call(arguments,
4),f=this.taskIdIndex++;this._tasks.push({action:a,delay:c,times:b,leftTime:c,content:d,args:e,id:f});return f},remove:function(a){console.log("remove");for(var c=0;c<this._tasks.length;c++)if(this._tasks[c].id==a){this._tasks.splice(c,1);break}},setTimeout:function(a,c){var b=Array.prototype.slice.call(arguments,2),d=this.taskIdIndex++;this._tasks.push({action:a,delay:c,times:1,leftTime:c,args:b,id:d});return d},clearTimeout:function(a){this.remove(a)},setInterval:function(a,c){var b=Array.prototype.slice.call(arguments,
2),d=this.taskIdIndex++;this._tasks.push({action:a,delay:c,times:0,leftTime:c,args:b,id:d});return d},clearInterval:function(a){this.remove(a)},schedule:function(a,c){var b=Array.prototype.slice.call(arguments,4),d=this.taskIdIndex++;this._tasks.push({action:a,delay:delay,times:times,leftTime:delay,content:c,args:b,id:d});return d},unschedule:function(a,c){for(var b,d=0;d<this._tasks.length;d++){b=this._tasks[d];if(b.action==a&&(!c||b.content==c))this._tasks.splice(d,1)}},scheduleUpdate:function(a){var c=
a.update;c&&this.schedule(c,a,0)},unscheduleUpdate:function(a){var c=a.update;c&&this.unschedule(c,a)}};g.getInstance=function(a){if(!this._instance)this._instance=new g(a);return this._instance}})();
(function(){var g=yhge.times.Scheduler,a=yhge.times.AnimationManager=function(){this.initialize.apply(this,arguments)};a.prototype={initialize:function(c){this._animations=[];c&&c.addTask(this._run,g.Animation,this)},_run:function(c){for(var b=0,d=this._animations.length;b<d;b++)this._animations[b].update(c)},add:function(c){this._animations.push(c);return this},remove:function(c){for(var b=0,d=this._animations.length;b<d;b++)this._animations[b]==c&&this._animations.splice(b,1);return this}};a.getInstance=
function(c){if(!this._instance)this._instance=new a(c);return this._instance}})();
(function(){var g=yhge.core.Class({overrides:{classname:"Animation",_enable:true,_currentFrame:0,_totalFrames:0,_totalDuration:0,_frames:null,_elapsed:0,initialize:function(a){console.log("init "+this.classname);this._frames=[];this._duration=a&&a.duration||30},update:function(a){if(this._enable){this._elapsed+=a;this._currentFrame=Math.floor(this._elapsed/this._duration)%this._totalFrames}},updateGroup:function(a,c){if(this._enable)this._currentFrame=(this._currentFrame+c)%this._totalFrames},play:function(){this._enable=
true},stop:function(){this._enable=false},setCurrentFrame:function(a){this._currentFrame=a<0?0:a>=this._totalFrames?this._totalFrames-1:a;return this},getCurrentFrameIndex:function(){return this._currentFrame},nextFrame:function(){this._currentFrame=(this._currentFrame+1)%this._totalFrames;this.stop();return this},prevFrame:function(){if(this._currentFrame==0)this._currentFrame=this._totalFrames-1;else this._currentFrame--;this.stop();return this},gotoAndPlay:function(a){this.setCurrentFrame(a);this.play();
return this},gotoAndStop:function(a){this.setCurrentFrame(a);this.stop();return this},addFrame:function(a,c){c==null?this._frames.push(a):this._frames.splice(c,0,a);this._totalFrames++;this._totalDuration+=this._duration;return this},removeFrame:function(a){if(typeof a=="number"){if(a<0||a>=this._frames.length)return;this._frames.splice(a,1)}else{a=this._frames.indexOf(a);if(a<0)return;this._frames.splice(a,1)}this._totalFrames--;this._totalDuration-=this._duration;return this},getFrame:function(a){return a>
-1&&a<this._totalFrames?this._frames[a]:null},getCureentFrame:function(){return this._frames[this._currentFrame]},setFrames:function(a){this._frames=a;this._totalFrames=a.length;this._totalDuration=this._duration*this._totalFrames;return this},addFrames:function(a,c){if(c==null)this._frames=this._frames.concat(a);else{c=[c,0].concat(a);this._frames=Array.prototype.splice.apply(this._frames,c)}this._totalFrames+=a.length;this._totalDuration=this._duration*a.length;return this},getFrames:function(){return this._frames},
getFramesCount:function(){return this._totalFrames},getTotalFrames:function(){return this._totalFrames},setDuration:function(a){this._duration=a;return this},getDuration:function(){return this._duration}}});yhge.renderer.Animation=g;yhge.animation.Animation=g})();
(function(){var g=yhge.core.Class({overrides:{classname:"AnimationVariable",_enable:true,_currentFrame:0,_totalFrames:0,_totalDuration:0,_frames:null,_elapsed:0,initialize:function(){console.log("init "+this.classname);this._frames=[];this._durations=[]},update:function(a){if(this._enable){this._elapsed+=a;this._currentFrame=this._getIndex()}},_getIndex:function(){var a=this._elapsed%this._totalDuration;if(a==0)return this._totalFrames-1;if(a<=this._durations[0])return 0;var c=0,b=this._totalFrames-
1,d;do{d=Math.floor((c+b)/2);if(this._durations[d]>a)b=d;else if(this._durations[d]<a)c=d;else break}while(b-c>1);return d==c?d+1:d},play:function(){this._enable=true},stop:function(){this._enable=false},setCurrentFrame:function(a){this._currentFrame=a<0?0:a>=this._totalFrames?this._totalFrames-1:a},getCurrentFrameIndex:function(){return this._currentFrame},nextFrame:function(){this._currentFrame=(this._currentFrame+1)%this._totalFrames;this.stop()},prevFrame:function(){if(this._currentFrame==0)this._currentFrame=
this._totalFrames-1;else this._currentFrame--;this.stop()},gotoAndPlay:function(a){this.setCurrentFrame(a);this.play()},gotoAndStop:function(a){this.setCurrentFrame(a);this.stop()},addFrame:function(a,c,b){b==null?this._frames.push(a):this._frames.splice(b,0,a);this._totalFrames++;this._totalDuration+=c;this._durations.push(this._totalDuration)},removeFrame:function(a){var c;if(typeof a=="number"){if(a<0||a>=this._frames.length)return;c=a;this._frames.splice(a,1)}else{a=this._frames.indexOf(a);if(a<
0)return;this._frames.splice(a,1);c=a}this._totalFrames--;this._updateDurationSeque(c)},_updateDurationSeque:function(a){if(!(a<0&&a>=this._durations.length)){var c=this._durations[a]-this._durations[a-1];this._totalDuration-=c;this._durations.splice(a,1);a=a;for(var b=this._durations.length;a<b;a++)this._durations[a]-=c}},getFrame:function(a){return a>-1&&a<this._totalFrames?this._frames[a]:null},getCureentFrame:function(){return this._frames[this._currentFrame]}}});yhge.renderer.AnimationVariable=
g;yhge.animation.AnimationVariable=g})();
(function(){var g=function(){this.initialize.apply(this,arguments)};g=yhge.core.Class({base:g,extend:yhge.core.Accessor,overrides:{classname:"Frame",_offset:null,_isSetSize:false,initialize:function(a,c,b,d){console.log("init Frame",typeof a);this._size={width:0,height:0};this._offset={x:0,y:0};if(!a.texture){a={texture:a,rect:c};b&&(a.offset=b);d&&(a.size=d)}this._isSetSize=!!a.size;this.setAttributes(a)},setWidth:function(a){this._size.width=a;this._isSetSize=true;return this},getWidth:function(){return this._size.width},
setHeight:function(a){this._size.height=a;this._isSetSize=true;return this},getHeight:function(){return this._size.height},setSize:function(a){if(a instanceof Array){this._size.width=a[0];this._size.height=a[1]}else{this._size.width=a.width;this._size.height=a.height}this._isSetSize=true;return this},getSize:function(){return this._size},setRect:function(a){this._rect=a instanceof Array?{origin:{x:a[0],y:a[1]},size:{width:a[2],height:a[3]}}:a;if(!this._isSetSize){this._size.width=this._rect.size.width;
this._size.height=this._rect.size.height}return this},getRect:function(){return this._rect},setUv:function(a){this._uv=a instanceof Array?{x:a[0],y:a[1],width:a[2],height:a[3]}:a;return this},getUv:function(){return this._uv},setTexture:function(a){this._texture=a;return this},getTexture:function(){return this._texture},setOffset:function(a){this._offset=a instanceof Array?{x:a[0],y:a[1]}:a;return this},getOffset:function(){return this._offset}}});yhge.renderer.Frame=g;yhge.animation.Frame=g})();
(function(){var g=yhge.core.Class({extend:yhge.animation.Animation,overrides:{classname:"ActionAnimation",_loop:0,_totalFrame:0,_deltaFrame:0,update:function(a){if(this._enable){this._elapsed+=a;var c=Math.floor(this._elapsed/this._duration);a=c-this._totalFrame;this._totalFrame=c;this._deltaFrame=_deltaFrame;for(c=0;c<a;c++){this._currentFrame=(this._currentFrame+1)%this._totalFrames;this.doCurrentFrameAction()}}},updateGroup:function(a,c){if(this._enable)for(a=0;a<c;a++){this._currentFrame=(this._currentFrame+
1)%this._totalFrames;this.doCurrentFrameAction()}},doCurrentFrameAction:function(){for(var a=this._frames[this._currentFrame].actions,c,b=0,d=a.length;b<d;b++){c=a[b];c.action.apply(c.target,c.arguments)}},doAction:function(a){a=this._frames[a].actions;for(var c,b=0,d=a.length;b<d;b++){c=a[b];c.action.apply(c.target,c.arguments)}}}});yhge.renderer.ActionAnimation=g;yhge.animation.ActionAnimation=g})();
(function(){var g=yhge.core.Class(yhge.core.Accessor,{classname:"AnimationGroup",_elapsed:0,_duration:0,_frame:0,_nextFrame:0,_frameRate:60,_frameSkipAble:true,_root:null,initialize:function(a){this._animations=[];this.setAttributes(a);this._maxDelta=5E4/this._frameRate},update:function(a){if(this._frameSkipAble){if(a>this._maxDelta)a=this._duration;this._elapsed+=a;this._nextFrame=Math.floor(this._elapsed*this._frameRate/1E3);if(this._nextFrame>this._frame){for(var c=this._nextFrame-this._frame,
b=0,d=this._animations.length;b<d;b++)this._animations[b].updateGroup(a,c);this._frame=this._nextFrame}}else{this._frame++;b=0;for(d=this._animations.length;b<d;b++)this._animations[b].updateGroup(a,1)}},setFrameRate:function(a){this._frameRate=a;this._duration=1E3/a;return this},getFrameRate:function(){return this._frameRate},setDuration:function(a){this._frameRate=1E3/a;this._duration=a;return this},getDuration:function(){return this._duration},add:function(a){if(this._animations.indexOf(a)>-1)throw"animation already in group";
this._animations.push(a);return this},remove:function(a){for(var c=0,b=this._animations.length;c<b;c++)this._animations[c]==a&&this._animations.splice(c,1);return this}});yhge.animation.AnimationGroup=g})();
(function(){(yhge.input.Mouse=function(){this.initialize.apply(this,arguments)}).prototype={classname:"Mouse",initialize:function(g,a){this._context=g;this._processor=a;this.initEvent()},initEvent:function(){var g=this._context,a=this._processor,c=this._getOffset(this._context);g.onmousedown=function(b){a.trigger("mousedown",b.pageX-c.left,b.pageY-c.top)};g.onmouseup=function(b){a.trigger("mouseup",b.pageX-c.left,b.pageY-c.top)};g.onmousemove=function(b){a.onMousemove(b.pageX-c.left,b.pageY-c.top)};
g.onmouseout=function(b){a.onMouseout(b.pageX-c.left,b.pageY-c.to)};g.onclick=function(b){a.trigger("click",b.pageX-c.left,b.pageY-c.top)}},_getOffset:function(g){var a=g.offsetLeft,c=g.offsetTop;for(g=g.offsetParent;g;){a+=g.offsetLeft;c+=g.offsetTop;g=g.offsetParent}return{left:a,top:c}}}})();
(function(){var g=yhge.math.TransformQuatTree,a=yhge.event.UIEventListenerManager,c=yhge.event.MouseEventObject;(yhge.input.VisualEventProcessor=function(){this.initialize.apply(this,arguments)}).prototype={initialize:function(b,d){this._quatTree=new g(b);this._quatTree.build(d)},addObservable:function(b){this._quatTree.add(b)},removeObservable:function(b){this._quatTree.remove(b)},trigger:function(b,d,e){b=new c(b,true,true,d,e);if(d=this.filter(this._quatTree.getObjsContainPoint(d,e))){b.target=
d;a.dispatchEvent(d,b)}},onMousemove:function(b,d){var e=this.filter(this._quatTree.getObjsContainPoint(b,d));if(e){if(this._currentTarget==null){var f=new c("mouseover",true,true,b,d);f.target=e;a.dispatchEvent(e,f);this._currentTarget=e}else if(this._currentTarget!=e){f=new c("mouseout",true,true,b,d);f.target=this._currentTarget;f.relatedTarget=e;a.dispatchEvent(this._currentTarget,f);f=new c("mouseover",true,true,b,d);f.target=e;a.dispatchEvent(e,f);this._currentTarget=e}b=new c("mousemove",true,
true,b,d);b.target=e;a.dispatchEvent(e,b)}else if(this._currentTarget){f=new c("mouseout",true,true,b,d);f.target=this._currentTarget;a.dispatchEvent(this._currentTarget,f);this._currentTarget=null}},onMouseout:function(b,d){if(this._currentTarget){b=new c("mouseout",true,true,b,d);b.target=this._currentTarget;a.dispatchEvent(this._currentTarget,b);this._currentTarget=null}},onTouch:function(b,d){this.trigger("touch",b,d)},getTop:function(b,d){return this.filter(this._quatTree.getObjsContainPoint(b,
d))},filter:function(b){if(!b)return null;for(var d=b[0],e=1,f=b.length;e<f;e++)d=d._zOrder<b[e]._zOrder?b[e]:d;return d}}})();
(function(){var g=yhge.math.TransformMatrix,a=yhge.geo,c=function(){this.initialize.apply(this,arguments)};c.prototype={classname:"Node",initialize:function(){this._dirty=255;this._position={x:0,y:0};this._scaleY=this._scaleX=1;this._rotation=0;this._isRelativeAnchorPoint=true;this._anchorPoint={x:0,y:0};this._opacity=1;this._visible=true;this._zOrder=0;this._parent=null;this._children=[];this._retainCount=0},setPosition:function(b,d){if(typeof b=="object"){d=b.y;b=b.x}this._position.x=b;this._position.y=
d;this._dirty=255;return this},getPosition:function(){return this._position},setScaleX:function(b){this._scaleX=b;this._dirty=255;return this},getScaleX:function(){return this._scaleX},setScaleY:function(b){this._scaleY=b;this._dirty=255;return this},getScaleY:function(){return this._scaleY},setScale:function(b,d){this._scaleX=b;this._scaleY=typeof d=="undefined"?b:d;this._dirty=255;return this},getScale:function(){return this._scaleX==this._scaleY?this._scaleX:false},setRotation:function(b){this._rotation=
b;this._dirty=255;return this},getRotation:function(){return this._rotation},setIsRelativeAnchorPoint:function(b){this._isRelativeAnchorPoint=b;return this},getIsRelativeAnchorPoint:function(){return this._isRelativeAnchorPoint},setAnchorPoint:function(b,d){if(typeof b=="object"){d=b.y;b=b.x}this._anchorPoint.x=b;this._anchorPoint.y=d;this._dirty=255;return this},getAnchorPoint:function(){return this._anchorPoint},setOpacity:function(b){this._opacity=b;return this},getOpacity:function(){return this._opacity},
setVisible:function(b){this._visible=b;return this},getVisible:function(){return this._visible},setZOrder:function(b){this._zOrder=b;return this},getZOrder:function(){return this._zOrder},draw:function(){},render:function(b){if(this._visible){b.save();this.transform(b);b.globalAlpha=this._opacity;this.draw(b);for(var d=0,e=this._children.length;d<e;d++)this._children[d].render(b);b.restore()}},transform:function(b){var d=this.nodeToParentTransform();b.transform(d.a,d.b,d.c,d.d,d.tx,d.ty)},nodeToParentTransform:function(){if(this._dirty&
1){this._transformMatrix=g.getIdentity();if(!this._isRelativeAnchorPoint&&(this._anchorPoint.x!==0||this._anchorPoint.y!==0))this._transformMatrix.setTranslate(this._anchorPoint.x,this._anchorPoint.y);if(this._position.x!=0||this._position.y!=0)this._transformMatrix.setTranslate(this._position.x,this._position.y);this._rotation!==0&&this._transformMatrix.setRotate(a.degreesToRadians(this._rotation));this._scaleX==1&&this._scaleY==1||this._transformMatrix.setScale(this._scaleX,this._scaleY);if(this._anchorPoint.x!=
0||this._anchorPoint.y!=0)this._transformMatrix.setTranslate(-this._anchorPoint.x,-this._anchorPoint.y);this._dirty&=-2}return this._transformMatrix},parentToNodeTransform:function(){if(this._dirty&2){this._inverse=this.nodeToParentTransform().invert();this._dirty&=-3}return this._inverse},nodeToWorldTransform:function(){for(var b=this.nodeToParentTransform().clone(),d=this._parent;d;){b=b.concat(d.nodeToParentTransform());d=d._parent}return b},worldToNodeTransform:function(){return this.nodeToWorldTransform().invert()},
screenToLocal:function(b,d){return this.worldToNodeTransform().pointApply(b,d)},localToScreen:function(b,d){return this.nodeToWorldTransform().pointApply(b,d)},boundingRect:function(){return this.nodeToParentTransform().rectApply(0,0,this._width,this._height)},worldBoundingRect:function(){return this.nodeToWorldTransform().rectApply(0,0,this._width,this._height)},setParent:function(b){this._parent=b;return this},getParent:function(){return this._parent},addChild:function(b){for(var d=b._zOrder,e=
false,f=0,h=this._children.length;f<h;f++)if(this._children[f]._zOrder>d){e=true;this._children.splice(f,0,b);break}e||this._children.push(b);b._addedToParent(this);return this},removeChild:function(b){var d=this._children.indexOf(b);if(d>-1){this._children.splice(d,1);b._willRemoveFromParent()}else throw new Error("removeChild called for a node that is not a child");return this},_addedToParent:function(b){this._parent&&this._parent.removeChild(this);this._parent=b},_willRemoveFromParent:function(){this._parent=
null},getChildren:function(){this._children.slice()},retain:function(){this._retainCount++},release:function(){--this._retainCount==0&&this.destroy()},destroy:function(){for(var b=this._children;b.length;)this.removeChild(b[0]);this._parent&&this._parent.removeChild(this)}};yhge.renderer.Node=c;yhge.renderer.DIRTY_ALL=255;yhge.renderer.TRANSFORM_DIRTY=1;yhge.renderer.INVERSE_DIRTY=2})();
(function(){var g=yhge.core.Class([yhge.renderer.Node,yhge.core.Accessor],{classname:"Sprite",initialize:function(a){g._super_.initialize.apply(this,arguments);this.setAttributes(a)},draw:function(a){var c=this._uv;c?a.drawImage(this._texture,c.x,c.y,c.width,c.height,0,0,this._width,this._height):a.drawImage(this._texture,0,0,this._width,this._height)},setTexture:function(a){this._texture=a;return this},getTexture:function(){return this._texture},setUv:function(a){this._uv=a;return this},getUv:function(){return this._uv},
setWidth:function(a){this._width=a;return this},getWidth:function(){return this._width},setHeight:function(a){this._height=a;return this},getHeight:function(){return this._height}});yhge.renderer.canvas.Sprite=g})();
(function(){var g=yhge.core.Class(yhge.renderer.canvas.Sprite,{classname:"AnimateSprite",initialize:function(){g._super_.initialize.apply(this,arguments)},draw:function(a){var c=this._animation.getCureentFrame(),b=c._rect,d=c._offset,e=c._size;b?a.drawImage(c._texture,b.origin.x,b.origin.y,b.size.width,b.size.height,d.x,d.y,e.width,e.height):a.drawImage(c._texture,d.x,d.y,this._width,this._height)},setAnimation:function(a){this._animation&&this._unregisterAnimation(this._animation);this._animation=
a;this._registerAnimation(a);return this},getAnimation:function(){return this._animation},setFrame:function(a){this._frame=a;return this},_registerAnimation:function(){},_unregisterAnimation:function(){}});yhge.renderer.canvas.AnimateSprite=g})();
(function(){var g=yhge.core.Class(yhge.renderer.canvas.AnimateSprite,{classname:"AvatarSprite",initialize:function(){g._super_.initialize.apply(this,arguments)},draw:function(a){var c=this._animation.getCureentFrame(),b,d,e,f;if(c!=null)for(var h=0,i=c.length;h<i;h++){b=c[h];d=b._rect;e=b._offset||{x:0,y:0};if(b.transform){a.save();a.transform(b.transform.a,b.transform.b,b.transform.c,b.transform.d,b.transform.tx,b.transform.ty);if(d){f=b._size||{width:this._width,height:this._height};a.drawImage(b._texture,
d.origin.x,d.origin.y,d.size.width,d.size.height,e.x,e.y,f.width,f.height)}else a.drawImage(b._texture,e.x,e.y,this._width,this._height);a.restore()}else if(d){f=b._size||{width:this._width,height:this._height};a.drawImage(b._texture,d.origin.x,d.origin.y,d.size.width,d.size.height,e.x,e.y,f.width,f.height)}else a.drawImage(b._texture,e.x,e.y,this._width,this._height)}},setAnimation:function(a){this._animation=a;return this},getAnimation:function(){return this._animation}});yhge.renderer.canvas.AvatarSprite=
g})();
(function(){var g=yhge.core.Class([yhge.renderer.Node,yhge.core.Accessor],{classname:"Shape",initialize:function(a){g._super_.initialize.apply(this,arguments);this.setAttributes(a)},setWidth:function(a){this._width=a;return this},getWidth:function(){return this._width},setHeight:function(a){this._height=a;return this},getHeight:function(){return this._height},setColor:function(a){this._color=a;return this},getColor:function(){return this._color},setSolid:function(a){this._solid=a;return this},getSolid:function(){return this._solid}});
yhge.renderer.canvas.shape.Shape=g})();(function(){var g=yhge.renderer.canvas.shape.Rect=yhge.core.Class(yhge.renderer.canvas.shape.Shape,{classname:"Rect",initialize:function(){g._super_.initialize.apply(this,arguments)},draw:function(a){if(this._solid){a.fillStyle=this._color;a.fillRect(0,0,this._width,this._height)}else{a.strokeStyle=this._color;a.strokeRect(0,0,this._width,this._height)}}})})();
(function(){var g=yhge.core.Class(yhge.renderer.canvas.shape.Shape,{classname:"RoundRect",initialize:function(){this._radius={topLeft:{x:0,y:0},topRight:{x:0,y:0},bottomRight:{x:0,y:0},bottomLeft:{x:0,y:0}};g._super_.initialize.apply(this,arguments)},draw:function(a){var c=this._width,b=this._height,d=this._radius.topLeft,e=this._radius.topRight,f=this._radius.bottomLeft,h=this._radius.bottomRight;if(this._solid){a.fillStyle=this._color;a.beginPath();a.moveTo(0,d.y);a.lineTo(0,b-f.y);a.quadraticCurveTo(0,
b,f.x,b);a.lineTo(c-h.x,b);a.quadraticCurveTo(c,b,c,b-h.y);a.lineTo(c,e.y);a.quadraticCurveTo(c,0,c-e.x,0);a.lineTo(d.x,0);a.quadraticCurveTo(0,0,0,d.y);a.fill()}else{a.strokeStyle=this._color;a.beginPath();a.moveTo(0,d.y);a.lineTo(0,b-f.y);a.quadraticCurveTo(0,b,f.x,b);a.lineTo(c-h.x,b);a.quadraticCurveTo(c,b,c,b-h.y);a.lineTo(c,e.y);a.quadraticCurveTo(c,0,c-e.x,0);a.lineTo(d.x,0);a.quadraticCurveTo(0,0,0,d.y);a.stroke()}},setRadius:function(a){if(typeof a=="number")this._radius={topLeft:{x:a,y:a},
topRight:{x:a,y:a},bottomRight:{x:a,y:a},bottomLeft:{x:a,y:a}};else if(a instanceof Array)switch(a.length){case 1:a=a[0];this._radius={topLeft:{x:a,y:a},topRight:{x:a,y:a},bottomRight:{x:a,y:a},bottomLeft:{x:a,y:a}};break;case 2:this._radius={topLeft:{x:a[0],y:a[0]},topRight:{x:a[1],y:a[1]},bottomRight:{x:a[0],y:a[0]},bottomLeft:{x:a[1],y:a[1]}};break;case 3:this._radius={topLeft:{x:a[0],y:a[0]},topRight:{x:a[1],y:a[1]},bottomRight:{x:a[2],y:a[2]},bottomLeft:{x:a[1],y:a[1]}};break;case 4:default:this._radius=
{topLeft:{x:a[0],y:a[0]},topRight:{x:a[1],y:a[1]},bottomRight:{x:a[2],y:a[2]},bottomLeft:{x:a[3],y:a[3]}};break}else for(var c in a)for(var b in a[c])this._radius[c][b]=a[c][b];return this},getRadius:function(){return this._radius}});yhge.renderer.canvas.shape.RoundRect=g})();
(function(){var g=yhge.core.Class(yhge.renderer.canvas.shape.Shape,{classname:"Arc",initialize:function(){this._endAngle=this._startAngle=this._radius=0;this._anticlockwise=true;g._super_.initialize.apply(this,arguments)},draw:function(a){if(this._solid){a.fillStyle=this._color;a.beginPath();a.arc(0,0,this._radius,this._startAngle,this._endAngle,this._anticlockwise);a.fill()}else{a.strokeStyle=this._color;a.beginPath();a.arc(0,0,this._radius,this._startAngle,this._endAngle,this._anticlockwise);a.stroke()}},
setRadius:function(a){this._radius=a;return this},getRadius:function(){return this._radius},setStartAngle:function(a){this._startAngle=a;return this},getStartAngle:function(){return this._startAngle},setEndAngle:function(a){this._endAngle=a;return this},getEndAngle:function(){return this._endAngle},setAnticlockwise:function(a){this._anticlockwise=a;return this},getAnticlockwise:function(){return this._anticlockwise}});yhge.renderer.canvas.shape.Arc=g})();
(function(){var g=yhge.core.Class(yhge.renderer.canvas.shape.Shape,{classname:"Circle",initialize:function(){this._radius=0;g._super_.initialize.apply(this,arguments)},draw:function(a){if(this._solid){a.fillStyle=this._color;a.beginPath();a.arc(0,0,this._radius,0,Math.PI*2,true);a.fill()}else{a.strokeStyle=this._color;a.beginPath();a.arc(0,0,this._radius,0,Math.PI*2,true);a.stroke()}},setRadius:function(a){this._radius=a;return this},getRadius:function(){return this._radius}});yhge.renderer.canvas.shape.Circle=
g})();
(function(){var g=yhge.core.Class(yhge.renderer.canvas.shape.Shape,{classname:"Path",initialize:function(){this._records=[];g._super_.initialize.apply(this,arguments)},draw:function(b){for(var d=this._records,e=0,f=d.length;e<f;e++)c[d[e][0]].apply(b,d[e].slice(1))},setRecords:function(b){this._records=b;return this},getRecords:function(){return this._records}});g.parseShapeRecords=function(b,d){var e;d=d||CanvasRenderingContext2D.prototype;for(var f=0,h=b.length;f<h;f++){e=b[f];var i=e[1],k;if(e[0]==
"fillStyle"&&typeof i=="object"&&i.type){k=i.type=="linear"?d.createLinearGradient(-819.2,0,819.2,0):d.createRadialGradient(0,0,0,0,0,819.2);for(var j in i.stops)k.addColorStop(i.stops[j].position,i.stops[j].color);e[1]=k}}return b};yhge.renderer.canvas.shape.Path=g;var a=CanvasRenderingContext2D.prototype,c={moveTo:a.moveTo,lineTo:a.lineTo,arc:a.arc,quadraticCurveTo:a.quadraticCurveTo,bezierCurveTo:a.bezierCurveTo,fill:a.fill,stroke:a.stroke,clip:a.clip,beginPath:a.beginPath,closePath:a.closePath,
save:a.save,restore:a.restore,translate:a.translate,rotate:a.rotate,scale:a.scale,transform:a.transform,setTransform:a.setTransform,fillStyle:function(b){this.fillStyle=b},strokeStyle:function(b){this.strokeStyle=b}}})();(function(){var g=yhge.core.Class(yhge.renderer.canvas.shape.Shape,{classname:"SolidShape"});yhge.renderer.canvas.shape.SolidShape=g})();
(function(){var g=yhge.renderer.canvas.shape.Shape,a=yhge.core.Class(g,{classname:"SolidArc",initialize:function(){g._super_.initialize.apply(this,arguments)},draw:function(c){c.fillStyle=this._color;c.beginPath();c.arc(0,0,this._radius,this._startAngle,this._endAngle,this._anticlockwise);c.fill()}});yhge.renderer.canvas.shape.SolidArc=a})();
(function(){var g=yhge.core.Class(yhge.renderer.canvas.shape.Circle,{classname:"SolidCircle",draw:function(a){a.fillStyle=this._color;a.beginPath();a.arc(0,0,this._radius,0,Math.PI*2,true);a.fill()}});yhge.renderer.canvas.shape.SolidCircle=g})();(function(){var g=yhge.core.Class(yhge.renderer.canvas.shape.Rect,{classname:"SolidRect",draw:function(a){a.fillStyle=this._color;a.filleRect(0,0,this._width,this._height)}});yhge.renderer.canvas.shape.SolidRect=g})();
(function(){var g=yhge.core.Class(yhge.renderer.canvas.shape.RoundRect,{classname:"SolidRoundRect",draw:function(a){var c=this._width,b=this._height,d=this._radius.topLeft,e=this._radius.topRight,f=this._radius.bottomLeft,h=this._radius.bottomRight;a.fillStyle=this._color;a.beginPath();a.moveTo(0,d.y);a.lineTo(0,b-f.y);a.quadraticCurveTo(0,b,f.x,b);a.lineTo(c-h.x,b);a.quadraticCurveTo(c,b,c,b-h.y);a.lineTo(c,e.y);a.quadraticCurveTo(c,0,c-e.x,0);a.lineTo(d.x,0);a.quadraticCurveTo(0,0,0,d.y);a.fill()}});
yhge.renderer.canvas.shape.SolidRoundRect=g})();
(function(){var g=yhge.renderer.canvas.shape.Path,a=yhge.core.Class(g,{classname:"Shape",_uuid:0,setUuid:function(c){this._uuid=c;return this},getUuid:function(){return this._uuid},draw:function(c){a._super_.draw.call(this,c)},setTransformMatrix:function(c){this._transformMatrix=c;this._dirty=0;return this},getTransformMatrix:function(){return this.transformMatrix},clone:function(){var c=new a;c._records=this._records;c._width=this._width;c._height=this._height;c._color=this._color;c._solid=this._solid;
return c}});a.createShape=function(c,b){b.records=g.parseShapeRecords(b.records,c);return new a(b)};yhge.renderer.canvas.swf.Shape=a})();
(function(){var g=yhge.renderer.canvas.swf.Shape,a=SRT.analyzer,c=yhge.core.Class([yhge.renderer.Node,yhge.core.Accessor],{classname:"MorphShape",_uuid:0,initialize:function(d){c._super_.initialize.apply(this,arguments);this.setAttributes(d)},setUuid:function(d){this._uuid=d;return this},getUuid:function(){return this._uuid},draw:function(d){this._records=this._startRecords;c._super_.draw.call(this,d);this._records=this._endRecords;d.translate(this._startSize.width,0);c._super_.draw.call(this,d)},
setTransformMatrix:function(d){this._transformMatrix=d;this._dirty=0;return this},getTransformMatrix:function(){return this.transformMatrix},setStartAnchorPoint:function(d){this._startAnchorPoint=d;return this},getStartAnchorPoint:function(){return this._startAnchorPoint},setEndAnchorPoint:function(d){this._endAnchorPoint=d;return this},getEndAnchorPoint:function(){return this._endAnchorPoint},setStartSize:function(d){this._startSize=d;return this},getStartSize:function(){return this._startSize},
setEndSize:function(d){this._endSize=d;return this},getEndSize:function(){return this._endSize},setRatio:function(d){this._ratio=d;return this},getRatio:function(){return this._ratio},setStartBounds:function(d){this._startBounds=d;return this},getStartBounds:function(){return this._startBounds},setEndBounds:function(d){this._endBounds=d;return this},getEndBounds:function(){return this._endBounds},setFillStyles:function(d){this._fillStyles=d;return this},getFillStyles:function(){return this._fillStyles},
setLineStyles:function(d){this._lineStyles=d;return this},getLineStyles:function(){return this._lineStyles},setStartRecords:function(d){this._startRecords=d;return this},getStartRecords:function(){return this._startRecords},setEndRecords:function(d){this._endRecords=d;return this},getEndRecords:function(){return this._endRecords},toShape:function(d,e){return c.createShape(d,{uuid:this._uuid,startBounds:this._startBounds,endBounds:this._endBounds,fillStyles:this._fillStyles,lineStyles:this._lineStyles,
startRecords:this._startRecords,endRecords:this._endRecords},e)}}),b={};c.createShape=function(d,e,f){var h=b[e.uuid];h||(b[e.uuid]=h={});var i=h[f];if(!i){e=a.interpolateShape(e,f);i=g.createShape(d,a.shape(e));h[f]=i}return i};yhge.renderer.canvas.swf.MorphShape=c})();
(function(){var g=yhge.renderer.Node,a=yhge.core.Class([yhge.renderer.canvas.Sprite,yhge.animation.ActionAnimation],{classname:"MovieClip",_uuid:0,initialize:function(){this._currentFrame=0;this._frames=[];this._duration=30;this._childMovieClips=[];a._super_.initialize.apply(this,arguments)},setUuid:function(b){this._uuid=b;return this},getUuid:function(){return this._uuid},update:function(b,d){if(this._enable){this._currentFrame=(this._currentFrame+d)%this._totalFrames;for(var e=0,f=this._childMovieClips.length;e<
f;e++)this._childMovieClips[e].update(b,d)}},updateGroup:function(b,d){if(this._enable){this._currentFrame=(this._currentFrame+d)%this._totalFrames;for(var e=0,f=this._childMovieClips.length;e<f;e++)this._childMovieClips[e].updateGroup(b,d)}},draw:function(b){var d=this._frames[this._currentFrame],e;for(var f in d.elements){e=d.elements[f];e.character.setTransformMatrix(e.transform);e.character.render(b)}},setTransformMatrix:function(b){this._transformMatrix=b;this._dirty=0;return this},getTransformMatrix:function(){return this.transformMatrix},
setChildMovieClips:function(b){this._childMovieClips=b;return this},getChildMovieClips:function(){return this._childMovieClips},addChildMovieClip:function(b,d){typeof d=="undefined"?this._childMovieClips.push(b):this._childMovieClips.splice(d,0,b);return this},removeChildMovieClip:function(b){b=this._childMovieClips.indexOf(b);if(b>-1)this._childMovieClips.splice(b,1);else throw new Error("removeChild called for a node that is not a child");return this},clone:function(){var b=new a;b._currentFrame=
this._currentFrame=0;b._frames=this._frames;b._totalFrames=this._totalFrames;b._childMovieClips=this._childMovieClips.slice();return b}});a.sortElements=function(b){var d={},e=[];for(var f in b)e.push(f);e.sort(function(i,k){return i-k});for(var h in e)d[e[h]]=b[e[h]];return d};a.createMovieClip=function(b,d,e,f){var h,i,k,j=d.frames;f=new a({uuid:d.uuid,duration:f?1E3/f:d.duration});for(var l=0,m=j.length;l<m;l++){h=j[l];h.elements=a.sortElements(h.elements);for(var n in h.elements){i=h.elements[n];
if(k=e[i.characterId]){if(k.classname=="MorphShape")k=k.toShape(b,i.ratio);i.character=k}else delete h.elements[n]}f.addFrame(h)}b=d.childSprites;d={};l=0;for(m=b.length;l<m;l++){j=b[l];if(!d[j]){f.addChildMovieClip(e[j]);d[j]=true}}return f};var c={};a.parseDefine=function(b,d,e){for(var f,h,i,k=d.frames,j=0,l=k.length;j<l;j++){f=k[j];f.elements=a.sortElements(f.elements);for(var m in f.elements){h=f.elements[m];i=c[h.characterId];if(!i)if(i=e[h.characterId]){if(!(i instanceof g))switch(i.className){case "Shape":i=
Shape.createShape(b,i);break;case "MovieClip":i=new a(i);break;case "MorphShape":i=new MorphShape(i);break}c[h.characterId]=i}else{delete f.elements[m];continue}if(i.classname=="MorphShape")i=i.toShape(b,h.ratio);h.character=i}}b=d.childSprites;e=[];f={};j=0;for(l=b.length;j<l;j++){h=b[j];if(!f[h]){e.push(c[h]);f[h]=true}}return{uuid:d.uuid,childMovieClips:e,frames:k}};a.createMovieClip2=function(b,d,e){for(var f,h,i,k=d.frames,j=0,l=k.length;j<l;j++){f=k[j];f.elements=a.sortElements(f.elements);
for(var m in f.elements){h=f.elements[m];i=c[h.characterId];if(!i)if(i=e[h.characterId]){if(!(i instanceof g))switch(i.className){case "Shape":i=Shape.createShape(b,i);break;case "MovieClip":i=a.createMovieClip2(b,i,e);break;case "MorphShape":i=new MorphShape(i);break}c[h.characterId]=i}else{delete f.elements[m];continue}if(i.classname=="MorphShape")i=i.toShape(b,h.ratio);h.character=i}}b=d.childSprites;e=[];f={};j=0;for(l=b.length;j<l;j++){h=b[j];if(!f[h]){e.push(c[h]);f[h]=true}}return new a({uuid:d.uuid,
childMovieClips:e,frames:k})};yhge.renderer.canvas.swf.MovieClip=a})();(function(){var g=yhge.times.Scheduler,a=function(){this.initialize.apply(this,arguments)};a.prototype={classname:"Director",initialize:function(c){c.addTask(this._run,g.Render,this)},_run:function(){this._scene.render()},setScene:function(c){this._scene=c;return this}};a.getInstance=function(c){if(!this._instance)this._instance=new a(c);return this._instance};yhge.scene.Director=a})();
(function(){var g=yhge.scene.Scene=yhge.core.Class([yhge.renderer.Node,yhge.core.Accessor],{classname:"Scene",_width:0,_height:0,_background:null,_children:null,initialize:function(c){console.log("init Scene");this._children=[];this._position={x:0,y:0};this._background="#000";this.setAttributes(c)},render:function(c){c.fillStyle=this._background;c.fillRect(0,0,this._width,this._height);for(var b=0,d=this._children.length;b<d;b++)this._children[b].render(c)},setWidth:function(c){this._width=c;return this},
getWidth:function(){return this._width},setHeight:function(c){this._height=c;return this},getHeight:function(){return this._height},setBackground:function(c){this._background=c;return this},getBackground:function(){return this._background},addChild:function(c){g._super_.addChild.call(this,c)},removeChild:function(c){g._super_.removeChild.call(this,c)}}),a=yhge.scene.CanvasScene=yhge.core.Class(yhge.renderer.canvas.Node,{classname:"CanvasScene",initialize:function(){console.log("init CanvasScene");
a._super_.initialize.apply(this,arguments);this._isRelativeAnchorPoint=false},renderer:function(c){c.clearRect(this._position.x,this._position.y,this._width,this._height);a._super_.renderer.apply(this,arguments)}})})();
(function(){var g=yhge.times.Scheduler,a=yhge.scene.SceneUpdater=function(){this.initialize.apply(this,arguments)};a.prototype={classname:"SceneUpdater",initialize:function(c,b){this._scenes=[];this._context=b;c.addTask(this._run,g.Render,this);this.updateTimes=0},_run:function(c){this.updateTimes++;for(var b=0,d=this._scenes.length;b<d;b++)this._scenes[b].render(this._context,c)},add:function(c){this._scenes.push(c);return this},remove:function(c){for(var b=0,d=this._scenes.length;b<d;b++)this._scenes[b]==
c&&this._scenes.splice(b,1);return this}};a.getInstance=function(c,b){if(!this._instance)this._instance=new a(c,b);return this._instance}})();
(function(){var g=yhge.times.Scheduler,a=yhge.scene.SingleSceneUpdater=function(){this.initialize.apply(this,arguments)};a.prototype={classname:"SingleSceneUpdater",initialize:function(c,b){this._context=b;c.addTask(this._run,g.Render,this);this.updateTimes=0},_run:function(){this.updateTimes++;this._scene.render(this._context)},setScene:function(c){this._scene=c;return this}};a.getInstance=function(c,b){if(!this._instance)this._instance=new a(c,b);return this._instance}})();
(function(){var g=yhge.math.TransformQuatTree,a=yhge.event.UIEventListenerManager,c=yhge.event.MouseEventObject;(yhge.scene.VisualEventProcessor=function(){this.initialize.apply(this,arguments)}).prototype={initialize:function(b,d){this._quatTree=new g(b);this._quatTree.build(d)},addObservable:function(b){this._quatTree.add(b)},removeObservable:function(b){this._quatTree.remove(b)},trigger:function(b,d,e){b=new c(b,true,true,d,e);if(d=this.filter(this._quatTree.getObjsContainPoint(d,e))){b.target=
d;a.dispatchEvent(d,b)}},onMousemove:function(b,d){var e=this.filter(this._quatTree.getObjsContainPoint(b,d));if(e){if(this._currentTarget==null){var f=new c("mouseover",true,true,b,d);f.target=e;a.dispatchEvent(e,f);this._currentTarget=e}else if(this._currentTarget!=e){f=new c("mouseout",true,true,b,d);f.target=this._currentTarget;f.relatedTarget=e;a.dispatchEvent(this._currentTarget,f);f=new c("mouseover",true,true,b,d);f.target=e;a.dispatchEvent(e,f);this._currentTarget=e}b=new c("mousemove",true,
true,b,d);b.target=e;a.dispatchEvent(e,b)}else if(this._currentTarget){f=new c("mouseout",true,true,b,d);f.target=this._currentTarget;a.dispatchEvent(this._currentTarget,f);this._currentTarget=null}},onMouseout:function(b,d){if(this._currentTarget){b=new c("mouseout",true,true,b,d);b.target=this._currentTarget;a.dispatchEvent(this._currentTarget,b);this._currentTarget=null}},onTouch:function(b,d){this.trigger("touch",b,d)},getTop:function(b,d){return this.filter(this._quatTree.getObjsContainPoint(b,
d))},filter:function(b){if(!b)return null;for(var d=b[0],e=1,f=b.length;e<f;e++)d=d._zOrder<b[e]._zOrder?b[e]:d;return d}}})();
(function(){var g=function(){this.initialize.apply(this,arguments)},a=function(){};a.prototype=yhge;g.prototype=new a;yhge.core.mixin(g.prototype,{initialize:function(c){this.enable=this.initContext(c);c.noTimer||(c.singleton?this.initTimesSingleton(c):this.initTimes(c));this.initPlugins(c)},initContext:function(c){if(c=this.getContext(c.canvas,c.renderer)){this.context=c;return true}return false},initTimes:function(c){c=new yhge.times.Scheduler(c);var b=new yhge.times.Timer(c),d=new yhge.times.AnimationManager(c);
this.scheduler=c;this.timer=b;this.animationManager=d;c.run();return true},initTimesSingleton:function(c){c=new yhge.times.Scheduler.getInstance(c);var b=new yhge.times.Timer.getInstance(c),d=new yhge.times.AnimationManager.getInstance(c);this.scheduler=c;this.timer=b;this.animationManager=d;c.run();return true},initCanvas:function(c){var b=null;try{b=c.getContext("2d");this.isCanvas=true}catch(d){}b||alert("Unable to initialize canvas2d. Your browser may not support it.");return b},initWebGL:function(c){var b=
null;try{b=c.getContext("experimental-webgl");this.isWebGL=true}catch(d){}b||alert("Unable to initialize WebGL. Your browser may not support it.");return b},initPlugins:function(c){var b=c.plugins;if(b)for(var d=0,e=b.length;d<e;d++)b[d].init(this,c)},getContext:function(c,b){c=typeof c=="string"?document.getElementById(c):c;if(b=="canvas")return this.initCanvas(c);return this.initWebGL(c)||this.initCanvas(c)}});yhge.Engine=g})();
